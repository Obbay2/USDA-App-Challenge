var Helper=angular.module("nwHelper",[]);Helper.factory("locationService",["$http","$q",function(t,e){var a=function(n){var r={};r.method="JSONP",r.url="http://dev.virtualearth.net/REST/v1/Locations?output=json&jsonp=JSON_CALLBACK&CountryRegion=US&adminDistrict="+n+"&key=AgRH1NfLoOiOYRppfNJv6JAbhhnTEmXIoxjKvb7c0-AOC3s-Zo8rVIMGouCobWDx";var o={lat:"",lng:""},s=e.defer();return t(r).success(function(t){var e=angular.fromJson(t);null==e.resourceSets[0].resources[0]?(console.log("Missed "+n),a(n).then(function(t){s.resolve(t)})):null!==e.resourceSets[0].resources[0].point?(o.lat=e.resourceSets[0].resources[0].point.coordinates[0],o.lng=e.resourceSets[0].resources[0].point.coordinates[1],s.resolve(o)):null!==e.resourceSets[0].resources[0].geocodePoints&&(o.lat=e.resourceSets[0].resources[0].geocodePoints.coordinates[0],o.lng=e.resourceSets[0].resources[0].geocodePoints.coordinates[1],console.log(o),s.resolve(o))}).error(function(t,e){console.log(e),s.reject(e)}),s.promise};return{getStateLatLng:function(t){return a(t)}}}]),Helper.factory("stateService",["$http","$q",function(t,e){var a=function(){var t={alabama:{points:0,data:0,set:0,hit:0},alaska:{points:0,data:0,set:0,hit:0},arizona:{points:0,data:0,set:0,hit:0},arkansas:{points:0,data:0,set:0,hit:0},california:{points:0,data:0,set:0,hit:0},colorado:{points:0,data:0,set:0,hit:0},connecticut:{points:0,data:0,set:0,hit:0},delaware:{points:0,data:0,set:0,hit:0},florida:{points:0,data:0,set:0,hit:0},georgia:{points:0,data:0,set:0,hit:0},hawaii:{points:0,data:0,set:0,hit:0},idaho:{points:0,data:0,set:0,hit:0},illinois:{points:0,data:0,set:0,hit:0},indiana:{points:0,data:0,set:0,hit:0},iowa:{points:0,data:0,set:0,hit:0},kansas:{points:0,data:0,set:0,hit:0},kentucky:{points:0,data:0,set:0,hit:0},louisiana:{points:0,data:0,set:0,hit:0},maine:{points:0,data:0,set:0,hit:0},maryland:{points:0,data:0,set:0,hit:0},massachusetts:{points:0,data:0,set:0,hit:0},michigan:{points:0,data:0,set:0,hit:0},minnesota:{points:0,data:0,set:0,hit:0},mississippi:{points:0,data:0,set:0,hit:0},missouri:{points:0,data:0,set:0,hit:0},montana:{points:0,data:0,set:0,hit:0},nebraska:{points:0,data:0,set:0,hit:0},nevada:{points:0,data:0,set:0,hit:0},new_hampshire:{points:0,data:0,set:0,hit:0},new_jersey:{points:0,data:0,set:0,hit:0},new_mexico:{points:0,data:0,set:0,hit:0},new_york:{points:0,data:0,set:0,hit:0},north_carolina:{points:0,data:0,set:0,hit:0},north_dakota:{points:0,data:0,set:0,hit:0},ohio:{points:0,data:0,set:0,hit:0},oklahoma:{points:0,data:0,set:0,hit:0},oregon:{points:0,data:0,set:0,hit:0},pennsylvania:{points:0,data:0,set:0,hit:0},rhode_island:{points:0,data:0,set:0,hit:0},south_carolina:{points:0,data:0,set:0,hit:0},south_dakota:{points:0,data:0,set:0,hit:0},tennessee:{points:0,data:0,set:0,hit:0},texas:{points:0,data:0,set:0,hit:0},utah:{points:0,data:0,set:0,hit:0},vermont:{points:0,data:0,set:0,hit:0},virginia:{points:0,data:0,set:0,hit:0},washington:{points:0,data:0,set:0,hit:0},west_virginia:{points:0,data:0,set:0,hit:0},wisconsin:{points:0,data:0,set:0,hit:0},wyoming:{points:0,data:0,set:0,hit:0}};return{getClean:function(){return t}}},n=null,r=function(a){var n={},r={};r.method="GET",r.url="http://nass-api.azurewebsites.net/api/api_get?agg_level_desc=STATE";for(var o=Object.keys(a),s=0;s<o.length;s++)r.url+="&",r.url+=o[s]+"="+a[o[s]];var i=e.defer();return t(r).success(function(t){return n=angular.fromJson(t),i.resolve(n),i.promise}).error(function(t,e){console.log(e),i.reject(e)}),i.promise},o=function(a){var n=[],r={};r.method="GET",r.headers={Authorization:"Basic "+btoa("wW7wO99BMioS0cs/J+bsL1VF/Pa/qfNduvR9vr/L5rg:wW7wO99BMioS0cs/J+bsL1VF/Pa/qfNduvR9vr/L5rg")},r.url="https://api.datamarket.azure.com/Bing/Search/v1/Image?$format=JSON&Query=%27"+a+"%20landscape%27&Adult=%27Moderate%27&ImageFilters=%27Size%3AMedium%2BAspect%3AWide%27";var o=e.defer();return t(r).success(function(t){n.push(t.d.results[0].Thumbnail.MediaUrl),n.push(t.d.results[1].Thumbnail.MediaUrl),o.resolve(n)}).error(function(t,e){console.log(e),o.reject(e)}),o.promise},s=function(a){var n=[],r={};r.method="GET",r.headers={Authorization:"Basic "+btoa("wW7wO99BMioS0cs/J+bsL1VF/Pa/qfNduvR9vr/L5rg:wW7wO99BMioS0cs/J+bsL1VF/Pa/qfNduvR9vr/L5rg")},r.url="https://api.datamarket.azure.com/Bing/Search/v1/Web?$format=json&Query=%27"+a+"%20state%20wikipedia%27";var o=e.defer();return t(r).success(function(t){for(var e=0;e<t.d.results.length;e++)if(-1===t.d.results[e].Title.indexOf("University")){var r=t.d.results[e].Description;r=r.substring(0,a.length)+" "+r.substring(r.indexOf("is")),-1!==r.indexOf("...")&&(r=r.substring(0,r.indexOf("...")-1)),n.push(r),n.push(t.d.results[e].Url),o.resolve(n);break}}).error(function(t,e){console.log(e),o.reject(e)}),o.promise};return{getStateData:function(t){return r(t)},getImages:function(t){return o(t)},getWikipediaInformation:function(t){return s(t)},getStates:function(){return n},resetStates:function(){n=null,temp=new a,n=temp.getClean()}}}]),Helper.factory("mathService",function(){var t=function(t){for(var e=0,a=t.data,n=0;n<a.length;n++){var r=parseFloat(a[n].value);e+=r}var o=e/a.length;return Math.floor(o)},e=function(t){var e=t.data;return e.sort(function(t,e){return parseFloat(t.value)-parseFloat(e.value)}),t},a=function(t){var e=t;return e.sort(function(t,e){return parseFloat(t.points)-parseFloat(e.points)}),t},n=function(t){var e=t;return e.sort(function(t,e){return parseFloat(e.points)-parseFloat(t.points)}),t};return{getAverage:function(e){return t(e)},sortData:function(t){return e(t)},sortArrayAscending:function(t){return a(t)},sortArrayDescending:function(t){return n(t)}}}),Helper.factory("dataService",["stateService",function(t){var e=function(t){for(var e=0,a=t.length-1;a>=0;a--)0===Object.keys(t[a]).length&&(t.splice(a,1),e++);return e},a=function(t){for(var e=t.data.length-1;e>=0;e--)("(S)"===t.data[e].value||"(D)"===t.data[e].value)&&t.data.splice(e,1)},n=function(t){for(var e=0;e<t.data.length;e++)if("string"==typeof t.data[e].value||t.data[e].value instanceof String)for(;-1!==t.data[e].value.indexOf(",");)t.data[e].value=t.data[e].value.replace(",","")},r=function(t){for(var e=0;e<t.data.length;e++)parseFloat(t.data[e].average)>1e9?(t.data[e].value=parseFloat(t.data[e].value)/1e9,t.data[e].average=parseFloat(t.data[e].average)/1e9,t.data[e].unit_desc+=" (Billions)"):parseFloat(t.data[e].average)>1e6&&(t.data[e].value=parseFloat(t.data[e].value)/1e6,t.data[e].average=parseFloat(t.data[e].average)/1e6,t.data[e].unit_desc+=" (Millions)")},o=function(t,e){for(var a=0;a<t.data.length;a++)t.data[a].average=e},s=function(t){for(var e=0;e<t.data.length;e++)t.data[e].points=e+1},i=!1,u=0,d=function(){return i=i===!1?!0:!1},c=function(e,a){var n=t.getStates();n[e].set++,n[e].set>u&&(console.log(e),console.log(a))},l=function(e){var a=t.getStates();a[e].hit++},p=function(e){for(var a=t.getStates(),n=Object.keys(a),r=0;r<n.length;r++)1!==a[n[r]].hit&&(a[n[r]].points+=Math.round(e/2),a[n[r]].hit++);for(var r=0;r<n.length;r++)a[n[r]].hit=0},h=function(){for(var e=t.getStates(),a=Object.keys(e),n=0;n<a.length;n++)e[a[n]].set=0};return{removeEmpties:function(t){return e(t)},removeBadData:function(t){return a(t)},removeComma:function(t){return n(t)},reduceValue:function(t){return r(t)},addAverage:function(t,e){return o(t,e)},addPoints:function(t){return s(t)},toggleLoading:function(){return d()},trackData:function(t,e){return c(t,e)},addHit:function(t){return l(t)},addPointsReset:function(t){return p(t)},resetTrackData:function(){return h()},setYear:function(t){u=t}}}]);