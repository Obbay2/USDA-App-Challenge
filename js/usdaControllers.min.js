var USDAControllers=angular.module("usdaControllers",["mm.foundation","ngMap","chart.js","ngAnimate","nwHelper"]);USDAControllers.controller("HomeCtrl",["$scope","$q","$http","$timeout","stateService","mathService","locationService","dataService",function(e,t,a,s,o,r,n,c){var l={sector_desc:"ECONOMICS",group_desc:"EXPENSES",commodity_desc:"RENT",class_desc:"CASH%2C%20CROPLAND",prodn_practice_desc:"IRRIGATED",year:""},i={sector_desc:"ECONOMICS",group_desc:"EXPENSES",commodity_desc:"RENT",class_desc:"CASH%2C%20CROPLAND",prodn_practice_desc:"NON-IRRIGATED",year:""},d={sector_desc:"ECONOMICS",group_desc:"EXPENSES",commodity_desc:"RENT",class_desc:"CASH%2C%20PASTURELAND",year:""},m={sector_desc:"ECONOMICS",group_desc:"EXPENSES",commodity_desc:"EXPENSE%20TOTALS",class_desc:"PRODUCTION",unit_desc:"$",year:""},p={sector_desc:"ECONOMICS",group_desc:"PRICES%20PAID",commodity_desc:"RENT",class_desc:"PER%20COW-CALF",year:""},u={sector_desc:"ECONOMICS",group_desc:"PRICES%20PAID",commodity_desc:"RENT",class_desc:"PER%20HEAD",year:""},g={sector_desc:"ECONOMICS",group_desc:"INCOME",commodity_desc:"INCOME%2C%20FARM-RELATED",class_desc:"FOREST%20PRODUCTS%2C%20(EXCL%20CHRISTMAS%20TREES%20%26%20SHORT%20TERM%20WOODY%20CROPS%20%26%20MAPLE%20SYRUP)",domain_desc:"TOTAL",unit_desc:"$",year:""},h={sector_desc:"ECONOMICS",group_desc:"INCOME",commodity_desc:"INCOME%2C%20FARM-RELATED",class_desc:"AG%20TOURISM%20%26%20RECREATIONAL%20SERVICES",domain_desc:"TOTAL",unit_desc:"$",year:""},S={sector_desc:"ECONOMICS",group_desc:"INCOME",commodity_desc:"INCOME%2C%20FARM-RELATED",class_desc:"GOVT%20PROGRAMS%2C%20STATE%20%26%20LOCAL",domain_desc:"TOTAL",unit_desc:"$",year:""},f={sector_desc:"ECONOMICS",group_desc:"INCOME",commodity_desc:"INCOME%2C%20FARM-RELATED",class_desc:"PATRONAGE%20DIVIDENDS%20%26%20REFUNDS%20FROM%20COOPERATIVES",domain_desc:"TOTAL",unit_desc:"$",year:""},E={sector_desc:"ECONOMICS",group_desc:"INCOME",commodity_desc:"GOVT%20PROGRAMS",class_desc:"FEDERAL",domain_desc:"TOTAL",unit_desc:"$",year:""};e.sets={expenses:{selected:"Expenses",sets:6,startingYear:1999,years:15,scoreDesc:"A lower score means that a state is less expensive for farming. Land is cheaper to buy, livestock is cheaper to maintain, and general expenses are low.",accuracyDesc:""},income:{selected:"Income",sets:5,startingYear:1999,years:15,scoreDesc:"A higher score means that a state earns more income in the agricultural district. More income is made from tourism, selling of christmas trees, etc.",accuracyDesc:""}},e.contextualInformation=null,e.loading=!1,e.states=[],e.stateSelected=!1,e.sortType="rank",e.sortReverse=!1,e.max=0,e.selectedSetData=[],e.empties=0,e.charts=[],e.selectedState="",e.selectedStateData=[],e.stateDescription="",e.descriptionReference="",e.stateImageOne="",e.stateImageTwo="";var C=null,O=null;e.stateMarker={};var A=function(){o.resetStates(),e.states=[],e.stateSelected=!1,e.sortType="rank",e.sortReverse=!1,e.max=0,e.selectedSetData=[],e.empties=0};e.compileEconomicExpenseData=function(){var a=[];A(),e.loading=c.toggleLoading(),c.setYear(e.years),e.sets.expenses.accuracyDesc="Compiled from "+e.sets.expenses.sets+" data sets over "+e.sets.expenses.years+" years. Less accuracy means less data was collected over the time period for that state.",e.contextualInformation=e.sets.expenses;var s=o.getStates();a.push(_(l)),a.push(_(i)),a.push(_(d)),a.push(_(m)),a.push(_(p)),a.push(_(u)),t.all(a).then(function(t){for(var a=0;a<t.length;a++){for(var o=0;o<t[a].length;o++){for(var n=0;n<t[a][o].data.length;n++){var l=t[a][o].data[n].state_name.toLowerCase().replace(" ","_");c.trackData(l,t[a][o]),c.addHit(l),s[l].points+=t[a][o].data[n].points,s[l].data++}c.addPointsReset(t[a][o].data.length)}c.resetTrackData()}e.selectedSetData=t,console.log(e.selectedSetData);for(var a=0;a<t.length;a++)e.max+=t[a].length;for(var i=Object.keys(s),a=0;a<i.length;a++)s[i[a]].state=i[a],e.states.push(s[i[a]]);r.sortArrayAscending(e.states);for(var a=0;a<e.states.length;a++)e.states[a].rank=a+1;e.loading=c.toggleLoading()})},e.compileEconomicIncomeData=function(){var a=[];A(),e.loading=c.toggleLoading(),c.setYear(e.years),e.sets.income.accuracyDesc="Compiled from "+e.sets.income.sets+" data sets over "+e.sets.income.years+" years. Less accuracy means less data was collected over the time period for that state.",e.contextualInformation=e.sets.income;var s=o.getStates();a.push(_(g)),a.push(_(h)),a.push(_(S)),a.push(_(f)),a.push(_(E)),t.all(a).then(function(t){for(var a=0;a<t.length;a++){for(var o=0;o<t[a].length;o++){for(var n=0;n<t[a][o].data.length;n++){var l=t[a][o].data[n].state_name.toLowerCase().replace(" ","_");c.trackData(l,t[a][o]),c.addHit(l),s[l].points+=t[a][o].data[n].points,s[l].data++}c.addPointsReset(t[a][o].data.length)}c.resetTrackData()}e.selectedSetData=t;for(var a=0;a<t.length;a++)e.max+=t[a].length;for(var i=Object.keys(s),a=0;a<i.length;a++)s[i[a]].state=i[a],e.states.push(s[i[a]]);r.sortArrayDescending(e.states);for(var a=0;a<e.states.length;a++)e.states[a].rank=a+1;r.sortArrayAscending(e.states),e.loading=c.toggleLoading()})};var _=function(a){for(var s=[],n=t.defer(),l=e.contextualInformation.startingYear;l<e.contextualInformation.startingYear+e.contextualInformation.years;l++)a.year=l,s.push(o.getStateData(a));return t.all(s).then(function(t){e.empties=c.removeEmpties(t);for(var a=0;a<t.length;a++)c.removeBadData(t[a]),c.removeComma(t[a]),c.addAverage(t[a],r.getAverage(t[a])),c.reduceValue(t[a]),r.sortData(t[a]),c.addPoints(t[a]);n.resolve(t)}),n.promise};e.showStateData=function(t){if(e.loading=c.toggleLoading(),e.selectedState=t,e.stateSelected=!0,R(t),"Expenses"===e.contextualInformation.selected)for(var a={title:"",desc:"",unit:"",colors:["#0000A0","#FF7400"],labels:[],series:[],data:[[],[]],options:{scaleShowVerticalLines:!1}},s=0;s<e.selectedSetData.length;s++){a.series.push(t.toUpperCase().replace("_"," ")),a.series.push("US AVERAGE");for(var o=null,r=null,n=0;n<e.selectedSetData[s].length;n++){for(var l=null,i=null,d=null,m=!1,p=0;p<e.selectedSetData[s][n].data.length;p++){var u=e.selectedSetData[s][n].data[p].state_name.toLowerCase().replace(" ","_");if(t===u){r=e.selectedSetData[s][n].data[p],m=!0,l=e.selectedSetData[s][n].data[p].year,i=e.selectedSetData[s][n].data[p].value,d=e.selectedSetData[s][n].data[p].average,o=e.selectedSetData[s][n].data[p].unit_desc;break}}m&&(a.labels.push(l),a.data[0].push(i),a.data[1].push(d))}0!==a.labels.length&&(a.unit=o,D(a,r),console.log(a),e.charts.push(a)),a={title:"",desc:"",unit:"",colors:["#0000A0","#FF7400"],labels:[],series:[],data:[[],[]],options:{scaleShowVerticalLines:!1}}}else if("Income"===e.contextualInformation.selected)for(var a={title:"",desc:"",unit:"",colors:["#0000A0","#FF7400"],labels:[],series:[],data:[[],[]],options:{scaleShowVerticalLines:!1}},s=0;s<e.selectedSetData.length;s++){a.series.push(t.toUpperCase().replace("_"," ")),a.series.push("US AVERAGE");for(var o=null,r=null,n=0;n<e.selectedSetData[s].length;n++){for(var l=null,i=null,d=null,m=!1,p=0;p<e.selectedSetData[s][n].data.length;p++){var u=e.selectedSetData[s][n].data[p].state_name.toLowerCase().replace(" ","_");if(t===u){r=e.selectedSetData[s][n].data[p],m=!0,l=e.selectedSetData[s][n].data[p].year,i=e.selectedSetData[s][n].data[p].value,d=e.selectedSetData[s][n].data[p].average,o=e.selectedSetData[s][n].data[p].unit_desc;break}}m&&(a.labels.push(l),a.data[0].push(i),a.data[1].push(d))}0!==a.labels.length&&(a.unit=o,D(a,r),e.charts.push(a)),a={title:"",desc:"",unit:"",colors:["#0000A0","#FF7400"],labels:[],series:[],data:[[],[]],options:{scaleShowVerticalLines:!1}}}},e.hideStateData=function(){e.stateSelected=!1,e.charts=[],e.selectedState="",e.selectedStateData=[],e.stateDescription="",e.descriptionReference="",e.stateImageOne="",e.stateImageTwo="",e.stateMarker={}};var D=function(t,a){"Expenses"===e.contextualInformation.selected?"CASH, CROPLAND"===a.class_desc?"IRRIGATED"===a.prodn_practice_desc?(t.title="Cost of One Irrigated Farmland Acre per Month",t.desc="This is the cost to maintain and operate one acre of irrigated farmland per month. Even if the land is owned a lower number means that the land is cheaper."):"NON-IRRIGATED"===a.prodn_practice_desc&&(t.title="Cost of One Non-Irrigated Farmland Acre per Month",t.desc="This is the cost to maintain and operate one acre of non-irrigated farmland per month. Even if the land is owned a lower number means that the land is cheaper."):"CASH, PASTURELAND"===a.class_desc?(t.title="Cost of One Pastureland Acre per Month",t.desc="This is the cost to maintain and operate one acre of pastureland for livestock per month. Even if the land is owned a lower number means that the land is cheaper."):"PRODUCTION"===a.class_desc?(t.title="Total Production Costs Per Year",t.desc="This is the summative total of how much money farm operations spend per year. Consists of many things, land maintenance, taxes, livestock feed, etc."):"PER COW-CALF"===a.class_desc?(t.title="Cost of One Cow per Month",t.desc="The total cost to own and care for a cow or calf per month."):"PER HEAD"===a.class_desc&&(t.title="Cost of Any Livestock per Month",t.desc="The total cost to own and care for any livestock per month as an average between all common livestock."):"Income"===e.contextualInformation.selected&&("FOREST PRODUCTS, (EXCL CHRISTMAS TREES & SHORT TERM WOODY CROPS & MAPLE SYRUP)"===a.class_desc?(t.title="Total Earnings from Forest Products",t.desc="Total earnings from forest products. Does not include earnings from christmas trees, short woody crops, or maple syrup."):"AG TOURISM & RECREATIONAL SERVICES"===a.class_desc?(t.title="Total Earnings from Agricultural Tourism",t.desc="Agricultural tourism consists of tourists staying at a farm or ranch for any time period."):"GOVT PROGRAMS, STATE & LOCAL"===a.class_desc?(t.title="Total Earnings from State and Local Government Programs",t.desc="Total earnings from government programs that give incentives for the production of certain types of crops or reducing production of certain crops."):"PATRONAGE DIVIDENDS & REFUNDS FROM COOPERATIVES"===a.class_desc?(t.title="Total Earnings from Cooperatives",t.desc="A cooperative is a type of farm that is owned and run jointly by several members who all share profits."):"FEDERAL"===a.class_desc&&(t.title="Total Earnings from Federal Government Programs",t.desc="Total earnings from federally mandated government programs that give incentives for the production of certain types of crops or reducing production of certain crops."))},R=function(a){var r=o.getImages(a.replace("_"," ")),l=o.getWikipediaInformation(a.replace("_"," ")),i=n.getStateLatLng(a.replace("_","%20"));t.all([r,l,i]).then(function(t){e.loading=c.toggleLoading(),e.stateImageOne=t[0][0],e.stateImageTwo=t[0][1],e.stateDescription=t[1][0],e.descriptionReference=t[1][1],s(function(){google.maps.event.trigger(C,"resize"),google.maps.event.trigger(O,"resize"),C.setCenter(t[2]),O.setCenter(t[2]),e.stateMarker=t[2]},10)})};e.changeSortType=function(t){t===e.sortType?e.sortReverse=e.sortReverse===!1?!0:!1:(e.sortType=t,e.sortReverse=!1)},e.getTableColor=function(e){return e%2===1?!0:!1},e.getScoreMax=function(){return e.states[e.states.length-1].points},e.getScoreBarColor=function(t){var a=e.getScoreMax(),a=parseInt(a),t=parseInt(t),s=Math.floor(t/a*100);return"Expenses"===e.contextualInformation.selected?s>80?"alert":s>40&&80>=s?null:40>=s?"success":null:"Income"===e.contextualInformation.selected?s>80?"success":s>40&&80>=s?null:40>=s?"alert":null:void 0},e.getStateDataValue=function(){var t=o.getStates();return t[e.selectedState].data},e.getStateMax=function(){return e.max},e.getStatePercentage=function(){return Math.round(e.getStateDataValue()/e.getStateMax()*100)},e.$on("mapInitialized",function(t,a){null===C?(C=a,C.setCenter({lat:39,lng:89}),C.setZoom(6),C.setOptions(e.mapOptions)):(O=a,O.setCenter({lat:39,lng:89}),O.setZoom(6),O.setOptions(e.mapOptions))}),e.mapOptions={scrollwheel:!1,draggable:!1,disableDoubleClickZoom:!0,disableDefaultUI:!0,mapTypeId:google.maps.MapTypeId.HYBRID}}]);